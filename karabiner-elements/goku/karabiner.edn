{
  :applications {
    :slack_notion ["^com\\.tinyspeck\\.slackmacgap$" "^notion\\.id"]
    :notion ["^notion\\.id"]
    :slack ["^com\\.tinyspeck\\.slackmacgap$"]
    :excel ["^com\\.microsoft\\.Excel"]
    :no_return_apps [
      "^com\\.todesktop\\.230313mzl4w4u92" ;; Cursor
    ]
  }

  :devices {
      :geonix [
        {:vendor_id 14000 :product_id 12292} ;; Bluetooth
        {:vendor_id 14000 :product_id 12386} ;; USB
        {:vendor_id 14000 :product_id 12290} ;; 2.4GHz
      ]
  }
  
  :froms {
    ;; 波括弧 {}
    :sim_curved_brackets {:sim [:open_bracket :close_bracket] :modi {:mandatory [:left_shift]}}
    ;; ダブルクォート ""
    :sim_colon_double-quote {:sim [:semicolon :quote] :modi {:mandatory [:left_shift]}}
  }

  :tos {
    ;; 角括弧 []
    :to_square_brackets_jp_non-xls [{:key :open_bracket} {:key :close_bracket} {:key :return_or_enter :modi [:control :option :shift]}                          {:key :left_arrow}]
    :to_square_brackets_jp_xls     [{:key :open_bracket} {:key :close_bracket} {:key :return_or_enter :modi [:control :option :shift]} {:key :u :modi :control} {:key :left_arrow}]
    :to_square_brackets_en_non-xls [{:key :open_bracket} {:key :close_bracket}                                                                                  {:key :left_arrow}]
    :to_square_brackets_en_xls     [{:key :open_bracket} {:key :close_bracket}                                                         {:key :u :modi :control} {:key :left_arrow}]

    ;; 波括弧 {}
    :to_curly_brackets_jp_non-xls [{:key :open_bracket :modi :shift} {:key :close_bracket :modi :shift} {:key :return_or_enter :modi [:control :option :shift]}                          {:key :left_arrow}]
    :to_curly_brackets_jp_xls     [{:key :open_bracket :modi :shift} {:key :close_bracket :modi :shift} {:key :return_or_enter :modi [:control :option :shift]} {:key :u :modi :control} {:key :left_arrow}]
    :to_curly_brackets_en_non-xls [{:key :open_bracket :modi :shift} {:key :close_bracket :modi :shift}                                                                                  {:key :left_arrow}]
    :to_curly_brackets_en_xls     [{:key :open_bracket :modi :shift} {:key :close_bracket :modi :shift}                                                         {:key :u :modi :control} {:key :left_arrow}]

    ;; 丸括弧 ()
    :to_parentheses_jp_non-xls [{:key :9 :modi :shift} {:key :0 :modi :shift} {:key :return_or_enter :modi [:control :option :shift]}                          {:key :left_arrow}]
    :to_parentheses_jp_xls     [{:key :9 :modi :shift} {:key :0 :modi :shift} {:key :return_or_enter :modi [:control :option :shift]} {:key :u :modi :control} {:key :left_arrow}]
    :to_parentheses_en_non-xls [{:key :9 :modi :shift} {:key :0 :modi :shift}                                                                                  {:key :left_arrow}]
    :to_parentheses_en_xls     [{:key :9 :modi :shift} {:key :0 :modi :shift}                                                         {:key :u :modi :control} {:key :left_arrow}]

    ;; シングルクォート ''
    :to_quotes_non-xls [{:key :quote} {:key :quote}                          {:key :left_arrow}]
    :to_quotes_xls     [{:key :quote} {:key :quote} {:key :u :modi :control} {:key :left_arrow}]

    ;; ダブルクォート ""
    :to_double_quotes_non-xls [{:key :quote :modi :shift} {:key :quote :modi :shift}                          {:key :left_arrow}]
    :to_double_quotes_xls     [{:key :quote :modi :shift} {:key :quote :modi :shift} {:key :u :modi :control} {:key :left_arrow}]

    ;; バッククォート ``
    :to_graves_non-xls [{:key :grave_accent_and_tilde} {:key :grave_accent_and_tilde}                          {:key :left_arrow}]
    :to_graves_xls     [{:key :grave_accent_and_tilde} {:key :grave_accent_and_tilde} {:key :u :modi :control} {:key :left_arrow}]
  }
  
  :input-sources {
    :ja {:language "ja"}
  }

  :templates {
    :launch "osascript -e 'tell application \"%s\" to activate'"
  }

  :main [
    {:des "CAPSハイパーキー: Caps_lockを Shift, Command, Control, Option に置換する"
     :rules [
      [:caps_lock [:!CTOleft_shift]]
      [:!!a [:launch "Arc"]]
      [:!!c [:launch "Cursor"]]
      [:!!d [:launch "Dictionaries"]]
      [:!!l [:launch "DeepL"]]
      [:!!f [:launch "Finder"]]
      [:!!n [:launch "Notion"]]
      [:!!o [:launch "Obsidian"]]
      [:!!p [:launch "1Password"]]
      [:!!r [:launch "Reminders"]]
      [:!!s [:launch "Slack"]]
      [:!!w [:launch "Warp"]]
    ]}

    {:des "英かな：左右⌘キーを単独で押したときは英数・かなキーとして扱う"
     :rules [
      [:left_command :left_command   nil {:alone :japanese_eisuu}]
      [:right_command :right_command nil {:alone :japanese_kana}]
    ]}

    {:des "アプリ横断でショートカットキーを統一"
     :rules [
      ;; Slack & Notion
      [:!Cl :!Ck :slack_notion] ;; 検索 ⌘ L -> ⌘ K

      ;; Notion
      [:!CSTc :!CTl :notion]  ;; ブロックリンクコピー ⌘⇧^ C -> ⌘^ L
      [:!CS7  :!CO6 :notion]  ;; 番号付き箇条書き ⌘⇧ 7 -> ⌘⌥ 6
      [:!CS8  :!CO5 :notion]  ;; 箇条書き ⌘⇧ 8 -> ⌘⌥ 5
      [:!CS9  :!CO4 :notion]  ;; チェックリスト ⌘⇧ 9 -> ⌘⌥ 4

      ;; Slack
      [:!Ce :!CSc :slack];; コード ⌘ E -> ⌘⇧ C (Notion's shortcut)
    ]}

    {:des "Comboで括弧を自動的に閉じてカーソルを中に移動"
     :rules [
      ;; ^⌥⇧リターンは日本語の確定動作（かわせみで定義必要：「変換と確定」→「全文節確定」、「候補操作」→「候補決定」）
      ;; '"`は半角直接入力設定なので確定不要。
      
      ;; 不等号 <>
      ;; ,. → 不等号 <>（共通）
      [[:comma :period] [:!Scomma :!Speriod :!TOSreturn_or_enter      :left_arrow] [:ja :!excel]]  ;; 日本語、Excel以外
      [[:comma :period] [:!Scomma :!Speriod :!TOSreturn_or_enter :!Tu :left_arrow] [:ja :excel]]   ;; 日本語、Excel
      [[:comma :period] [:!Scomma :!Speriod                           :left_arrow] [:!ja :!excel]] ;; 日本語以外、Excel以外
      [[:comma :period] [:!Scomma :!Speriod                      :!Tu :left_arrow] [:!ja :excel]]  ;; 日本語以外、Excel

      ;; 角括弧 []
      ;; [] → 角括弧 []（ビルドインキーボード）
      [[:open_bracket :close_bracket] :to_square_brackets_jp_non-xls [:ja :!excel]]  ;; 日本語、Excel以外
      [[:open_bracket :close_bracket] :to_square_brackets_jp_xls     [:ja :excel]]   ;; 日本語、Excel
      [[:open_bracket :close_bracket] :to_square_brackets_en_non-xls [:!ja :!excel]] ;; 日本語以外、Excel以外
      [[:open_bracket :close_bracket] :to_square_brackets_en_xls     [:!ja :excel]]  ;; 日本語以外、Excel
      ;; fg → 角括弧 []（Geonix）
      [[:f :g] :to_square_brackets_jp_non-xls [:geonix :ja :!excel]]  ;; 日本語、Excel以外
      [[:f :g] :to_square_brackets_jp_xls     [:geonix :ja :excel]]   ;; 日本語、Excel
      [[:f :g] :to_square_brackets_en_non-xls [:geonix :!ja :!excel]] ;; 日本語以外、Excel以外
      [[:f :g] :to_square_brackets_en_xls     [:geonix :!ja :excel]]  ;; 日本語以外、Excel

      ;; 波括弧 {}
      ;; {} → 波括弧 {}
      [:sim_curved_brackets :to_curly_brackets_jp_non-xls [:ja :!excel]]  ;; 日本語、Excel以外
      [:sim_curved_brackets :to_curly_brackets_jp_xls     [:ja :excel]]   ;; 日本語、Excel
      [:sim_curved_brackets :to_curly_brackets_en_non-xls [:!ja :!excel]] ;; 日本語以外、Excel以外
      [:sim_curved_brackets :to_curly_brackets_en_xls     [:!ja :excel]]  ;; 日本語以外、Excel
      ;; vb → 波括弧 {}（Geonix）
      [[:v :b] :to_curly_brackets_jp_non-xls [:geonix :ja :!excel]]  ;; 日本語、Excel以外
      [[:v :b] :to_curly_brackets_jp_xls     [:geonix :ja :excel]]   ;; 日本語、Excel
      [[:v :b] :to_curly_brackets_en_non-xls [:geonix :!ja :!excel]] ;; 日本語以外、Excel以外
      [[:v :b] :to_curly_brackets_en_xls     [:geonix :!ja :excel]]  ;; 日本語以外、Excel

      ;; 丸括弧 ()
      ;; 90 → 丸括弧 ()
      [[:9 :0] :to_parentheses_jp_non-xls [:ja :!excel]]  ;; 日本語、Excel以外
      [[:9 :0] :to_parentheses_jp_xls     [:ja :excel]]   ;; 日本語、Excel
      [[:9 :0] :to_parentheses_en_non-xls [:!ja :!excel]] ;; 日本語以外、Excel以外
      [[:9 :0] :to_parentheses_en_xls     [:!ja :excel]]  ;; 日本語以外、Excel
      ;; nm → 丸括弧 (Geonix)
      [[:n :m] :to_parentheses_jp_non-xls [:geonix :ja :!excel]]  ;; 日本語、Excel以外
      [[:n :m] :to_parentheses_jp_xls     [:geonix :ja :excel]]   ;; 日本語、Excel
      [[:n :m] :to_parentheses_en_non-xls [:geonix :!ja :!excel]] ;; 日本語以外、Excel以外
      [[:n :m] :to_parentheses_en_xls     [:geonix :!ja :excel]]  ;; 日本語以外、Excel

      ;; シングルクォート ''
      ;; ;' → シングルクォート ''
      [[:semicolon :quote] :to_quotes_non-xls [:!excel]] ;; 言語非依存、Excel以外
      [[:semicolon :quote] :to_quotes_xls     [:excel]]  ;; 言語非依存、Excel
      ;; .; → シングルクォート ''（Geonix）
      [[:period :semicolon] :to_quotes_non-xls [:geonix :!excel]] ;; 言語非依存、Excel以外
      [[:period :semicolon] :to_quotes_xls     [:geonix :excel]]  ;; 言語非依存、Excel

      ;; ダブルクォート ""
      ;; :" → ダブルクォート ""
      [:sim_colon_double-quote :to_double_quotes_non-xls [:!excel]] ;; 言語非依存、Excel以外
      [:sim_colon_double-quote :to_double_quotes_xls     [:excel]]  ;; 言語非依存、Excel
      ;; lp → ダブルクォート ""（Geonix）
      [[:l :p] :to_double_quotes_non-xls [:geonix :!excel]] ;; 言語非依存、Excel以外
      [[:l :p] :to_double_quotes_xls     [:geonix :excel]]  ;; 言語非依存、Excel

      ;; バッククォート ``
      ;; `1 → バッククォート ``
      [[:grave_accent_and_tilde :1] :to_graves_non-xls [:!excel]] ;; 言語非依存、Excel以外
      [[:grave_accent_and_tilde :1] :to_graves_xls     [:excel]]  ;; 言語非依存、Excel
      ;; ESC w → バッククォート ``（Geonix）
      [[:escape :w] :to_graves_non-xls [:geonix :!excel]] ;; 言語非依存、Excel以外
      [[:escape :w] :to_graves_xls     [:geonix :excel]]  ;; 言語非依存、Excel
    ]}

    {:des "通常のリターンを変換確定キーとして扱う"
     :rules [
      ;; ⇧リターンは日本語の確定動作（かわせみで定義必要：「変換と確定」→「全文節確定」、「候補操作」→「候補決定」）＋改行（アプリに依る）
      [:return_or_enter   :!Sreturn_or_enter :no_return_apps] ;; リターン単打を⇧リターンに置き換え、変換確定しかしない
      [:!!return_or_enter :return_or_enter]                   ;; ✦リターンで通常のリターン
    ]}

    {:des "⌥- → Markdownの箇条書き"
     :rules [
      [:!Ohyphen [:japanese_eisuu :hyphen :spacebar :japanese_kana] :ja]
      [:!Ohyphen [                :hyphen :spacebar]                :!ja]
    ]}

    {:des "⌥9 → 丸括弧閉じ"
     :rules [
      [:!O9 :to_parentheses_jp_non-xls [:ja :!excel]]
      [:!O9 :to_parentheses_jp_xls     [:ja :excel]]
      [:!O9 :to_parentheses_en_non-xls [:!ja :!excel]]
      [:!O9 :to_parentheses_en_xls     [:!ja :excel]]
    ]}

    {:des "かな時 ' 単押しで、「」閉じ＆カーソル移動"
     :rules [
      [:quote :to_square_brackets_jp_non-xls [:ja :!excel]] ;; 日本語、Excel以外
      [:quote :to_square_brackets_jp_xls [:ja :excel]]      ;; 日本語、Excel
      [:!Oquote [:quote] [:ja]]                             ;; ⌥ ' で、通常入力
    ]}

    {:des "Geonix用：F19とF20を英かなキーに"
     :rules [
      ;; 英かな：GeonixをBluetooth接続すると英かなキーが認識しないので、別キーを割り当て、Karabinerで変換する
      [:f19 :japanese_eisuu :geonix]
      [:f20 :japanese_kana  :geonix]
    ]}
  ]
}